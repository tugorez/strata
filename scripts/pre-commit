#!/bin/bash

# Ensure we are in the root of the Melos workspace
if [ ! -f "melos_strata_monorepo.iml" ]; then
    echo "‚ùå Error: This script must be run from the root of a Melos workspace."
    exit 1
fi

# Exit immediately if a command exits with a non-zero status
set -e

# --- Format Check ---
echo "‚úÖ 1/3: Checking formatting..."
# Assumes you have a 'format' script in melos.yaml that runs in --dry-run mode
melos run format
echo "    Formatting is correct."

# --- Analyze ---
echo "‚úÖ 2/3: Running analyzer..."
melos run analyze
echo "    Analyzer found no issues."

# --- Test ---
echo "‚úÖ 3/3: Running tests..."
melos run test
echo "    All tests passed."

echo "üöÄ Pre-commit checks passed successfully. Committing..."
exit 0
